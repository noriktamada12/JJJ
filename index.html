<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Chat - Teman Curhat</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            height: 100vh;
            height: 100dvh;
            overflow: hidden;
            background: #0a0a0a;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            height: 100dvh;
            max-width: 480px;
            margin: 0 auto;
            background: #fff;
        }

        /* Header - WhatsApp Style */
        .header {
            background: #0088cc;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            min-height: 60px;
        }

        .back-button {
            color: white;
            font-size: 24px;
            background: none;
            border: none;
            padding: 5px;
            cursor: pointer;
        }

        .avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            /* TEMPAT ISI FOTO PROFIL AI - Ganti URL di bawah ini */
            background-image: url('https://image2url.com/images/1762013950552-cb4bb996-8b4a-41bb-92d0-c57b61294ea1.jpeg');
            background-size: cover;
            background-position: center;
            background-color: #128c7e;
            flex-shrink: 0;
        }

        .header-info {
            flex: 1;
        }

        .header-info h2 {
            font-size: 16px;
            color: #fff;
            font-weight: 500;
            margin-bottom: 2px;
        }

        .header-info p {
            font-size: 13px;
            color: rgba(255, 255, 255, 0.8);
        }

        .header-actions {
            display: flex;
            gap: 20px;
        }

        .header-actions button {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
            padding: 5px;
        }

        /* Chat Area - WhatsApp Style */
         .chat-area {
            flex: 1;
            overflow-y: auto;
            padding: 10px 8px;
            /* FOTO BACKGROUND CHAT - Upload foto Anda dan ganti URL di bawah ini */
            background-image: url('https://image2url.com/images/1762013992637-1bc93dca-2b88-4899-b5fb-92cb656b23ba.jpeg');
            background-size: contain;
            background-position: center;
            background-attachment: fixed;
            position: relative;
        }

        /* Overlay untuk membuat text lebih terbaca */
        .chat-area::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
        
            z-index: 0;
        }

        .messages {
            position: relative;
            z-index: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .message {
            display: flex;
            gap: 5px;
            max-width: 75%;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.user {
            align-self: flex-end;
            flex-direction: row-reverse;
        }

        .message-bubble {
            padding: 8px 12px;
            border-radius: 8px;
            line-height: 1.4;
            word-wrap: break-word;
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
            font-size: 14.5px;
            position: relative;
        }

        .message.ai .message-bubble {
            background: #fff;
            color: #000;
            border-top-left-radius: 0;
        }

        .message.user .message-bubble {
            background: #fff;
            color: #000;
            border-top-right-radius: 0;
        }

        .message-time {
            font-size: 11px;
            color: #667781;
            align-self: flex-end;
            padding: 0 3px;
            white-space: nowrap;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: none;
            padding: 10px 12px;
            background: #fff;
            border-radius: 8px;
            border-top-left-radius: 0;
            width: fit-content;
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
            position: relative;
            z-index: 1;
        }

        .typing-indicator span {
            height: 8px;
            width: 8px;
            background: #667781;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1.4s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-8px);
            }
        }

        /* Input Area - WhatsApp Style */
        .input-area {
            padding: 8px;
            background: #f0f0f0;
            display: flex;
            gap: 8px;
            align-items: flex-end;
        }

        .input-container {
            flex: 1;
            background: white;
            border-radius: 21px;
            display: flex;
            align-items: center;
            padding: 0 15px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }

        #messageInput {
            flex: 1;
            padding: 10px 0;
            border: none;
            outline: none;
            font-size: 15px;
            resize: none;
            font-family: inherit;
            max-height: 100px;
            background: transparent;
        }

        #sendButton {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: #0088cc;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
            flex-shrink: 0;
        }

        #sendButton:active {
            transform: scale(0.95);
        }

        #sendButton:disabled {
            background: #a0a0a0;
            cursor: not-allowed;
        }

        /* Settings */
        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .settings-content {
            background: white;
            padding: 24px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            max-height: 90vh;
            overflow-y: auto;
        }

        .settings-content h3 {
            margin-bottom: 20px;
            color: #000;
            font-size: 18px;
        }

        .settings-content p {
            font-size: 13px;
            color: #666;
            margin-bottom: 12px;
        }

        .settings-content input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .settings-content button {
            width: 100%;
            padding: 12px;
            background: #0088cc;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .settings-content button:active {
            background: #0088cc;
        }

        .close-settings {
            background: #f0f0f0 !important;
            color: #000 !important;
        }

        .error-message {
            color: #ff4444;
            font-size: 12px;
            margin-top: -10px;
            margin-bottom: 10px;
        }

        /* Scrollbar */
        .chat-area::-webkit-scrollbar {
            width: 6px;
        }

        .chat-area::-webkit-scrollbar-thumb {
            background: rgba(0,0,0,0.2);
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="avatar"></div>
            <div class="header-info">
                <h2>J</h2>
                <p id="statusText">online</p>
            </div>
        </div>

        <div class="chat-area" id="chatArea">
            <div class="messages" id="messages">
                <div class="message ai">
                    <div class="message-bubble">
                        Hai Aku J üòä
                    </div>
                    <div class="message-time"><?php echo date('H:i'); ?></div>
                </div>
            </div>
            <div class="typing-indicator" id="typingIndicator">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>

        <div class="input-area">
            <div class="input-container">
                <textarea 
                    id="messageInput" 
                    placeholder="Ketik pesan" 
                    rows="1"
                    onkeydown="handleKeyPress(event)"
                ></textarea>
            </div>
            <button id="sendButton" onclick="sendMessage()">‚û§</button>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <h3>Pengaturan API</h3>
            <p>Masukkan OpenAI API Key Anda untuk mulai chat</p>
            <input 
                type="password" 
                id="apiKeyInput" 
                placeholder="sk-..." 
                value=""
            >
            <div class="error-message" id="errorMessage"></div>
            <button onclick="saveApiKey()">Simpan API Key</button>
            <button class="close-settings" onclick="closeSettings()">Tutup</button>
        </div>
    </div>

    <script>
        // =====================================
        // TEMPAT ISI API KEY OPENAI ANDA
        // =====================================
        let API_KEY = '';  // Isi dengan API key Anda atau kosongkan untuk diisi lewat settings
        
        const messagesContainer = document.getElementById('messages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const typingIndicator = document.getElementById('typingIndicator');
        const chatArea = document.getElementById('chatArea');
        const statusText = document.getElementById('statusText');

        // Load API key dari localStorage
        if (localStorage.getItem('openai_api_key')) {
            API_KEY = localStorage.getItem('openai_api_key');
        }

        // Auto-resize textarea
        messageInput.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = Math.min(this.scrollHeight, 100) + 'px';
        });

        function openSettings() {
            document.getElementById('settingsModal').style.display = 'flex';
            document.getElementById('apiKeyInput').value = API_KEY;
        }

        function closeSettings() {
            document.getElementById('settingsModal').style.display = 'none';
            document.getElementById('errorMessage').textContent = '';
        }

        function saveApiKey() {
            const apiKey = document.getElementById('apiKeyInput').value.trim();
            if (!apiKey) {
                document.getElementById('errorMessage').textContent = 'API Key tidak boleh kosong!';
                return;
            }
            API_KEY = apiKey;
            localStorage.setItem('openai_api_key', apiKey);
            document.getElementById('errorMessage').textContent = '';
            closeSettings();
            addMessage('API Key berhasil disimpan! Sekarang kamu bisa mulai chat üëç', false);
        }

        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }

        function getCurrentTime() {
            const now = new Date();
            return now.getHours().toString().padStart(2, '0') + ':' + 
                   now.getMinutes().toString().padStart(2, '0');
        }

        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${isUser ? 'user' : 'ai'}`;
            
            messageDiv.innerHTML = `
                <div class="message-bubble">${content}</div>
                <div class="message-time">${getCurrentTime()}</div>
            `;
            
            messagesContainer.appendChild(messageDiv);
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function showTyping() {
            typingIndicator.style.display = 'block';
            chatArea.scrollTop = chatArea.scrollHeight;
        }

        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;

            if (!API_KEY) {
                openSettings();
                return;
            }

            addMessage(message, true);
            messageInput.value = '';
            messageInput.style.height = 'auto';
            
            sendButton.disabled = true;
            showTyping();
            statusText.textContent = 'mengetik...';

            try {
                const response = await fetch('https://api.openai.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'gpt-3.5-turbo',
                        messages: [
                            {
                                role: 'system',
                                content: 'Kamu adalah teman curhat yang baik, empati, dan supportif. Berbicara dengan bahasa Indonesia yang santai dan ramah seperti teman dekat. Dengarin dan kasih respon yang hangat dan membantu. Gunakan emoji sesekali untuk membuat percakapan lebih nyaman. Jawab dengan singkat dan natural seperti chat WhatsApp.'
                            },
                            {
                                role: 'user',
                                content: message
                            }
                        ],
                        temperature: 0.8,
                        max_tokens: 500
                    })
                });

                const data = await response.json();
                
                if (data.error) {
                    throw new Error(data.error.message);
                }

                hideTyping();
                const aiResponse = data.choices[0].message.content;
                addMessage(aiResponse);
                statusText.textContent = 'online';

            } catch (error) {
                hideTyping();
                console.error('Error:', error);
                addMessage('Maaf ada error nih üòÖ Coba cek API key kamu atau koneksi internet ya!');
                statusText.textContent = 'online';
            } finally {
                sendButton.disabled = false;
            }
        }

        // Close modal saat klik di luar
        window.onclick = function(event) {
            const modal = document.getElementById('settingsModal');
            if (event.target === modal) {
                closeSettings();
            }
        }

        // Scroll to bottom saat load
        window.onload = function() {
            chatArea.scrollTop = chatArea.scrollHeight;
        }
    </script>
</body>
</html>
